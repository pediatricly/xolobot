{% load static %}
<!DOCTYPE html>
<html>
<head>
    <title>Zoey the Xolo</title>
    <link rel="stylesheet" href="{% static 'chatbot/style.css' %}">
</head>
<body>
<div class="container">
    <div class="header">
        <img src="{% static 'chatbot/zoey.jpg' %}" alt="Zoey">
        <h1>Zoey, CFO of the Household</h1>
    </div>

    <div id="chat" class="chat"></div>

    <form id="chat-form">
        <input type="text" id="message" placeholder="Speak, subordinateâ€¦" autocomplete="off" />
        <button type="submit">Send</button>
    </form>
</div>

<script>
const form = document.getElementById("chat-form");
const input = document.getElementById("message");
const chat = document.getElementById("chat");
const button = form.querySelector("button");

function addMessage(text, cls) {
    const div = document.createElement("div");
    div.className = "message " + cls;
    div.textContent = text;
    chat.appendChild(div);
    chat.scrollTop = chat.scrollHeight;
}

form.onsubmit = async (e) => {
    e.preventDefault();
    const text = input.value.trim();
    if (!text) return;

    addMessage(text, "user");
    input.value = "";
    button.disabled = true;

    // ğŸ‘‡ Placeholder while waiting
    const thoughts = [
      "Zoey is considering your requestâ€¦ ğŸ•",
      "Zoey is judging youâ€¦",
      "Zoey is consulting the budgetâ€¦",
      "Zoey is sunbathing. One moment.",
    ];
    
    const thinking = document.createElement("div");
    thinking.className = "message bot";
    thinking.textContent = thoughts[Math.floor(Math.random() * thoughts.length)];
    chat.appendChild(thinking);
    chat.scrollTop = chat.scrollHeight;

    try {
        const res = await fetch("/ask/", {
            method: "POST",
            headers: {
                "Content-Type": "application/x-www-form-urlencoded"
            },
            body: new URLSearchParams({ message: text })
        });

        const data = await res.json();
        chat.removeChild(thinking);
        addMessage(data.reply, "bot");
    } catch (err) {
        chat.removeChild(thinking);
        addMessage("Zoey is displeased. Try again.", "bot");
    }

    button.disabled = false;
};
</script>
</body>
</html>
